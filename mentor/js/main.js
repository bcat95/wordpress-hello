let langDataObject,filter_badwords=!1,copy_text_in_chat=!1,display_audio_button_answers=!1,use_text_stream=!0,is_gpt_model=!1,langLoaded=!1,CHAT_PHP_url="../php/api.php",microphone_speak_lang="",google_voice="",google_voice_lang_code="",badWords=[],langData=[],AI=[],array_voices=[],chat_minlength=0,chat_maxlength=0;async function initializePage(){await fetchLanguageData(),$("#loading").fadeOut("slow")}async function fetchLanguageData(){if(!langLoaded){langLoaded=!0;let e="/php/json.php?action=language";try{const t=await fetch(e),n=await t.json();return lang=Object.assign({},...n),n}catch(e){console.log("error")}}}async function fetchLoadData(e){let t="/php/json.php?action=prompt&id="+e+"&v="+randomNumber;try{const e=await fetch(t),n=await e.json();return AI=Object.assign({},...n),avatar_in_chat=AI.display_avatar?`<div class="user-image"><img onerror="this.src='../img/no-image.svg'" src="../${AI.image}" alt="${AI.image}" title="${AI.name}"></div>`:"",audio_in_chat=AI.use_google_voice?"<div class='chat-audio'><img data-play=\"false\" src='../img/btn_tts_play.svg'></div>":"",copy_text_in_chat=AI.display_copy_btn?`<button class="copy-text" onclick="copyText(this)"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> <span class="label-copy-code">${lang.copy_text1}</span></button>`:"",chat_minlength=AI.chat_minlength,chat_maxlength=AI.chat_maxlength,microphone_speak_lang=AI.mic_speak_lang,filter_badwords=AI.filter_badwords,google_voice_lang_code=AI.google_voice_lang_code,google_voice=AI.google_voice,is_gpt_model=AI.API_MODEL.includes("gpt-"),filter_badwords&&fetchBadWordsData(),n}catch(t){"undefined"==typeof lang?(await fetchLanguageData(),fetchLoadData(e)):toastr.error("❌"+t)}}$(".btn-send-chat").on("click",(function(){sendUserChat()})),window.addEventListener("load",initializePage);let randomNumber=Math.floor(1e8*Math.random());async function fetchBadWordsData(){let e="/json/badwords.json?v="+randomNumber;fetchLanguageData();try{const t=await fetch(e),n=await t.json();return badWords=n.badwords.split(","),badWords}catch(e){toastr.error("❌"+e)}}function sendUserChat(){let e=$("#chat").val();if(filter_badwords){const t=new RegExp(`\\b(${badWords.join("|")})(?=\\s|$)`,"gi");if(t.test(e)){const n=e.replace(t,(e=>"*".repeat(e.length)));return $("#chat").val(n),toastr.error(`${lang.badword_feedback}`),!1}}if(e.length<chat_minlength)return toastr.error(`${lang.error_chat_minlength} ${chat_minlength} ${lang.error_chat_minlength_part2}`),!1;e=escapeHtml(e),$("#overflow-chat").append(`\n\t\t<div class="conversation-thread thread-user">\n\t\t  <div class="message-container">\n\t\t    <div class="message-info">\n\t\t\t  ${copy_text_in_chat}\n\t\t\t  ${audio_in_chat}            \n\t\t      <div class="user-name"><h5>${lang.you}</h5></div>\n\t\t      <div class="message-text"><div class="chat-response">${e}</div></div>\n\t\t      <div class="date-chat"><img src="../img/icon-clock.svg"> ${currentDate()}</div>\n\t\t    </div>\n\t\t  </div>\n\t\t</div>\n\t`),scrollChatBottom(),hljs.highlightAll(),e.includes("/img")?appendChatImg(e):getResponse(e),$("#chat").val(""),disableChat()}const escapeHtml=e=>(e=e.replace(/↵↵.*?\./gs,""),/<code>|<\/code>|<pre>|<\/pre>/g.test(e)?e:e=(e=(e=(e=e.replace(/[&<>"'`{}()\[\]]/g,(e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"{":return"&#123;";case"}":return"&#125;";case"(":return"&#40;";case")":return"&#41;";case"[":return"&#91;";case"]":return"&#93;";default:return e}}))).replace(/&lt;span\s+class="get-stream"&gt;/g,"")).replace(/&lt;\/span&gt;/g,"")).replace(/```(\w+)?([\s\S]*?)```/g,'<pre><code>$2</code><button class="copy-code" onclick="copyCode(this)"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> <span class="label-copy-code">'+lang.copy_code1+"</span></button></pre>").replace(/(\d+\.\s)/g,"<strong>$1</strong>").replace(/(^[A-Za-z\s]+:)/gm,"<strong>$1</strong>"));function currentDate(){return(new Date).toLocaleString()}function copyText(e){const t=e.parentElement.querySelector(".chat-response"),n=document.createRange();n.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(n),document.execCommand("copy"),window.getSelection().removeAllRanges(),e.innerHTML=lang.copy_text2}function copyCode(e){const t=e.parentElement.querySelector("code"),n=document.createRange();n.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(n),document.execCommand("copy"),window.getSelection().removeAllRanges(),e.innerHTML=lang.copy_code2}function scrollChatBottom(){let e=document.getElementById("overflow-chat");e.scrollTop=e.scrollHeight,hljs.highlightAll(),setTimeout((function(){window.innerWidth<768&&window.scrollTo(0,document.documentElement.scrollHeight)}),100)}function stopChat(){if(source){enableChat(),source.close(),$(".cursor").remove();var e=$(".get-stream:last").html(),t=$("<div>").html(e).text().length;fetch("/modules/customer/customer-stop-chat.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({characterCount:t})}).then((e=>e.json())).then((e=>{e.error?console.log(e.message):"success"==e.message?updateCredits():console.log(e)})).catch((e=>console.log(e)))}}function disableChat(){$(".character-typing").css("visibility","visible"),$(".character-typing").css("display","flex"),$(".character-typing span").html(AI.name),$(".btn-send-chat,#chat").attr("disabled",!0),$(".btn-send-chat").hide(),$(".btn-cancel-chat").show()}function enableChat(){$(".character-typing").css("visibility","hidden"),$(".btn-send-chat,#chat").attr("disabled",!1),$(".btn-send-chat").show(),$(".btn-cancel-chat").hide(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||setTimeout((function(){$("#chat").focus()}),300)}async function getResponse(e){""!=$("#selectTone").val()&&(e+="↵↵ Please write in "+$("#selectTone").val()+" tone."),""!=$("#selectWritingStyle").val()&&(e+="↵↵ "+$("#selectWritingStyle").val()+" writing style."),""!=$("#selectLanguage").val()&&(e+="↵↵Answer in language "+$("#selectLanguage").val()+".");const t=new URLSearchParams;t.append("prompt",e),t.append("ai_id",AI.id);try{const e=generateUniqueID();source=new SSE(CHAT_PHP_url,{headers:{"Content-Type":"application/x-www-form-urlencoded"},payload:t,method:"POST"}),streamChat(source,e),source.stream(),$("#overflow-chat").append(`\n\n        <div class="conversation-thread thread-ai">\n          ${avatar_in_chat}\n          <div class="message-container">\n            <div class="message-info">\n\t\t\t\t\t  ${copy_text_in_chat}\n\t\t\t\t\t  ${audio_in_chat}            \n              <div class="user-name"><h5>${AI.name}</h5></div>\n              <div class="message-text">\n                <div class="chat-response ${e}"><span class='get-stream'></span><span class='cursor'></span></div>\n              </div>\n              <div class="date-chat"><img src="../img/icon-clock.svg"> ${currentDate()}</div>\n            </div>\n          </div>\n        </div>\n\t\t\t`),$(`.chat_${e} .chat-audio`).hide(),scrollChatBottom()}catch(e){toastr.error(`Error creating SSE: ${e}`)}}function streamChat(e,t){let n="",a="";e.addEventListener("message",(function(e){let o=e.data,s={};if("string"==typeof o){if(o.startsWith("[ERROR]")){let e=o.substr(7).trim();return toastr.error(e),void enableChat()}if("[DONE]"===o)return $(".cursor").remove(),str=$(`.${t}`).html(),str=escapeHtml(str),$(`.${t}`).html(str),$(`.chat_${t} .chat-audio`).fadeIn("slow"),enableChat(),scrollChatBottom(),updateSessionChat(AI.slug),use_text_stream||($(`.${t}`).append(n),scrollChatBottom()),updateCredits(),!1;const a=JSON.parse(e.data);if("[CHAT_LIMIT]"===a.error){const e=document.getElementById("modalDemo"),t=new bootstrap.Modal(e);return $(".conversation-thread.thread-ai:last").remove(),enableChat(),t.show(),!1}if("[NO_CREDIT]"===a.error)return toastr.error(lang.credits_run_out),enableChat(),$(".conversation-thread.thread-ai:last").remove(),!1;try{s=JSON.parse(o)}catch(e){return void toastr.error(`Error parsing SSE data as JSON: ${e}`)}}if(!s||!s.choices||0===s.choices.length)return toastr.error("❌ "+s.message),enableChat(),void $(`.chat_${t}`).remove();var r=is_gpt_model?s.choices[0].delta:s.choices[0];a="",(r.content||r.text)&&(n+=r.content||r.text,a=r.content||r.text),use_text_stream&&$(`.${t} .get-stream`).append(formatSpecialCharactersRealTime(a))}))}function updateSessionChat(e){fetch("../modules/customer/chat-session.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"slug="+e+"&isFetchRequest=true"}).then((e=>e.json())).then((e=>{console.log(e)}))}function generateUniqueID(e="id_"){return`${e}${Date.now()}`}$(".btn-cancel-chat").on("click",(function(){stopChat()}));const formatSpecialCharactersRealTime=e=>(new DOMParser).parseFromString(`<!doctype html><body>${e}`,"text/html").body.textContent;function backToTop(){window.scrollTo({top:0,behavior:"smooth"})}const textarea=document.querySelector("#chat"),microphoneButton=document.querySelector("#microphone-button");if(microphoneButton){let e=!1;if("SpeechRecognition"in window||"webkitSpeechRecognition"in window){const t=new(window.SpeechRecognition||window.webkitSpeechRecognition);t.lang=microphone_speak_lang,t.continuous=!0,t.addEventListener("start",(()=>{$(".btn-send-chat").attr("disabled",!0),$("#microphone-button").attr("src","../img/mic-stop.svg")})),t.addEventListener("result",(e=>{const t=e.results[0][0].transcript;textarea.value+=t+"\n"})),t.addEventListener("end",(()=>{$(".btn-send-chat").attr("disabled",!1),$("#microphone-button").attr("src","../img/mic-start.svg"),e=!1})),microphoneButton.addEventListener("click",(()=>{navigator.permissions.query({name:"microphone"}).then((n=>{"granted"==n.state?e?(t.stop(),e=!1):(t.start(),e=!0):console.log("Please give microphone permission.")})).catch((e=>{console.log("Got error :",e)}))}))}else console.log("Web Speech Recognition API not supported by browser"),$("#microphone-button").hide()}const arrow=$(".arrow-up");arrow.toggleClass("arrow-down arrow-up"),$(".btn-options-input").click((function(){arrow.hasClass("arrow-down")?(arrow.removeClass("arrow-down").addClass("arrow-up"),$(".col-options-input .form-floating").show()):(arrow.removeClass("arrow-up").addClass("arrow-down"),$(".col-options-input .form-floating").hide())}));const localStorageKey="col-contacts-border-display";let displayState=localStorage.getItem(localStorageKey);function cleanString(e){return e=e.trim().replace(/<[^>]*>/g,"").replace(/[\u{1F600}-\u{1F64F}|\u{1F300}-\u{1F5FF}|\u{1F680}-\u{1F6FF}|\u{2600}-\u{26FF}|\u{2700}-\u{27BF}|\u{1F900}-\u{1F9FF}|\u{1F1E0}-\u{1F1FF}|\u{1F200}-\u{1F2FF}|\u{1F700}-\u{1F77F}|\u{1F780}-\u{1F7FF}|\u{1F800}-\u{1F8FF}|\u{1F900}-\u{1F9FF}|\u{1FA00}-\u{1FA6F}|\u{1FA70}-\u{1FAFF}]/gu,"").replace(/<div\s+class="date-chat".*?<\/div>/g,"").replace(/\n/g,"")}function cancelSpeechSynthesis(){window.speechSynthesis.cancel()}function doSpeechSynthesis(e,t){$("span.chat-response-highlight").each((function(){$(this).replaceWith($(this).text())}));const n=[...(e=cleanString(e)).matchAll(/[,.?!]/g)].map((e=>e.index)),a=[];let o=0;for(let t=0;t<n.length;t++)n[t]-o<100||(a.push(e.substring(o,n[t]+1)),o=n[t]+1);o<e.length&&a.push(e.substring(o));const s=a.map((e=>{const t=new SpeechSynthesisUtterance(e);if(t.lang=google_voice_lang_code,t.voice=speechSynthesis.getVoices().find((e=>e.name===google_voice)),!t.voice){const e=array_voices.find((e=>e.lang===t.lang));e&&(t.voice=speechSynthesis.getVoices().find((t=>t.name===e.name)))}return t}));s[s.length-1].addEventListener("end",(()=>{$(".chat-audio img").attr("src","../img/btn_tts_play.svg"),$(".chat-audio img").attr("data-play","false")}));!function n(o=0){if(o<s.length){const r=a[o];e.indexOf(r);t.html(t.html().replace(r,`<span class="chat-response-highlight">${r}</span>`)),speechSynthesis.speak(s[o]),s[o].addEventListener("end",(()=>{t.html(t.html().replace(`<span class="chat-response-highlight">${r}</span>`,r)),n(o+1)})),speechSynthesis.addEventListener("pause",(()=>{t.html(t.html().replace(`<span class="chat-response-highlight">${r}</span>`,r))}),{once:!0})}}()}function displayVoices(){console.table(array_voices)}function getTextToSpeechVoices(){window.speechSynthesis.getVoices().forEach((function(e){const t={name:e.name,lang:e.lang};array_voices.push(t)}))}function updateCredits(){const e=document.querySelector(".my-credits");e?(e.classList.add("pulse-animation"),setTimeout((()=>{e.classList.remove("pulse-animation")}),2e3),fetch("/modules/customer/customer-get-credits.php").then((e=>e.json())).then((e=>{if(e.error)console.log(e.message);else{const t=document.querySelector(".my-credits");t&&(t.textContent="My credits: "+e.credits)}})).catch((e=>console.log(e)))):console.log("Element with class 'my-credits' not found.")}displayState?$(".col-contacts-border").css("display",displayState):$(".col-contacts-border").css("display","none"),$(".toggle_employees_list").on("click",(function(){$(".col-contacts-border").toggle(),displayState=$(".col-contacts-border").css("display"),localStorage.setItem(localStorageKey,displayState)})),$(document).on("click",".chat-audio",(function(){var e=$(this),t=e.find("img"),n=e.siblings(".message-text"),a="true"==t.attr("data-play");if(a&&cancelSpeechSynthesis(),t.attr({src:"../img/btn_tts_"+(a?"play":"stop")+".svg","data-play":a?"false":"true"}),!a){cancelSpeechSynthesis();var o=n.html().replace(/<button\b[^>]*\bclass="[^"]*\bcopy-code\b[^"]*"[^>]*>.*?<\/button>/gi,"");"speechSynthesis"in window&&doSpeechSynthesis(o,n)}})),window.speechSynthesis.onvoiceschanged=function(){getTextToSpeechVoices()},document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".toggle-password");e&&e.addEventListener("click",(function(){const t=document.getElementById("floatingPassword");"password"===t.getAttribute("type")?(t.setAttribute("type","text"),e.classList.remove("bi-eye-slash"),e.classList.add("bi-eye")):(t.setAttribute("type","password"),e.classList.remove("bi-eye"),e.classList.add("bi-eye-slash"))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("floatingPassword"),t=document.getElementById("password-strength-bar"),n=document.getElementById("password-strength-text");e&&t&&n&&e.addEventListener("input",(function(e){const a=function(e){const t=6,n=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})"),a=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{6,})");if(e.length<t)return{percentage:0,class:"bg-danger",message:lang.password_have_6_char};if(n.test(e))return{percentage:100,class:"bg-success",message:lang.password_entered_strong};if(a.test(e))return{percentage:50,class:"bg-warning",message:lang.password_entered_medium};return{percentage:25,class:"bg-danger",message:lang.password_entered_medium}}(e.target.value);t.style.width=a.percentage+"%",t.classList.remove("bg-danger","bg-warning","bg-success"),t.classList.add(a.class),n.textContent=a.message}))}));var purchaseButtons=document.getElementsByClassName("purchase-btn");function showPaymentOptions(e){if("true"===e.getAttribute("data-single-payment-method"))redirectToSinglePaymentMethod(e);else{for(var t=e.parentElement.querySelector(".payment-options"),n=document.querySelectorAll(".payment-options:not(.d-none)"),a=0;a<n.length;a++)n[a]!==t&&n[a].classList.add("d-none");t.classList.toggle("d-none")}}function redirectToSinglePaymentMethod(e){var t=e.getAttribute("data-id"),n=e.getAttribute("data-href"),a="";stripeButtons.length?a="stripe":bankDepositButtons.length&&(a="bank_deposit"),a&&(disableAllButtonsExcept(e),setTimeout((function(){window.location.href=n+"/"+t+"?payment_method="+a}),1e3))}function disableAllButtonsExcept(e){for(var t=0;t<purchaseButtons.length;t++){var n=purchaseButtons[t];n.disabled=!0,n===e&&(n.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> '+lang.loading)}}function disableAllButtons(){for(var e=0;e<purchaseButtons.length;e++)purchaseButtons[e].disabled=!0,purchaseButtons[e].innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> '+lang.loading,purchaseButtons[e].parentElement.querySelector(".payment-options").classList.add("d-none")}for(var i=0;i<purchaseButtons.length;i++)purchaseButtons[i].addEventListener("click",(function(e){e.preventDefault(),showPaymentOptions(this)}));var stripeButtons=document.getElementsByClassName("stripe-btn"),bankDepositButtons=document.getElementsByClassName("bank-deposit-btn");for(i=0;i<stripeButtons.length;i++)stripeButtons[i].addEventListener("click",(function(e){e.preventDefault(),disableAllButtons();var t=this.parentElement.parentElement.querySelector(".purchase-btn").getAttribute("data-id");window.location.href=this.parentElement.parentElement.querySelector(".purchase-btn").getAttribute("data-href")+"/"+t+"?payment_method=stripe"}));for(i=0;i<bankDepositButtons.length;i++)bankDepositButtons[i].addEventListener("click",(function(e){e.preventDefault(),disableAllButtons();var t=this.parentElement.parentElement.querySelector(".purchase-btn").getAttribute("data-id");window.location.href=this.parentElement.parentElement.querySelector(".purchase-btn").getAttribute("data-href")+"/"+t+"?payment_method=bank_deposit"}));var closeButtons=document.getElementsByClassName("close-payment-options");for(i=0;i<closeButtons.length;i++)closeButtons[i].addEventListener("click",(function(e){e.preventDefault(),this.parentElement.classList.add("d-none")}));function scrollToFirstInvalidField(){const e=document.querySelector("form .form-control:invalid");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("categoryForm");e&&e.addEventListener("submit",(function(e){e.preventDefault();var t=document.getElementById("categoryAI").value;""!==t&&(window.location.href=t)}))})),document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector("form"),t=document.getElementById("submit-button");e&&e.addEventListener("submit",(function(e){e.target.checkValidity()?(t.disabled=!0,t.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> '+lang.loading):(e.preventDefault(),e.stopPropagation(),scrollToFirstInvalidField()),e.target.classList.add("was-validated")}),!1)}));